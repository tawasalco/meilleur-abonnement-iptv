---
import { getCollection } from 'astro:content';
import LanguageSwitcher from './LanguageSwitcher.astro';
import { getUITranslations, getLocalizedPath, defaultLanguage, type LanguageCode } from '../utils/i18n';

interface Props {
  currentLang?: string;
}

const { currentLang = defaultLanguage } = Astro.props;
const t = getUITranslations(currentLang as LanguageCode);

const serviceInfoEntries = await getCollection('service-info');
const serviceInfo = serviceInfoEntries[0];
const brandName = serviceInfo?.data?.brandName || 'meilleur abonnement iptv';

const localizedHref = (path: string) => {
  if (currentLang === defaultLanguage) return path;
  const cleanPath = path === '/' ? '' : path;
  return `/${currentLang}${cleanPath}` || `/${currentLang}`;
};

const navItems = [
  { href: localizedHref('/'), label: t.nav.home },
  { href: localizedHref('/pricing'), label: t.nav.pricing },
  { href: localizedHref('/features'), label: t.nav.features },
  { href: localizedHref('/installation-guides'), label: t.nav.setup || 'Setup' },
  { href: localizedHref('/reviews'), label: t.nav.reviews || 'Reviews' },
  { href: localizedHref('/faq'), label: t.nav.faq },
  { href: localizedHref('/contact'), label: t.nav.contact },
];
---

<header class="sticky top-0 z-50 w-full border-b border-border bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60">
  <div class="container mx-auto flex h-16 items-center justify-between px-4">
    <a href={localizedHref('/')} class="flex items-center gap-2 font-bold text-xl">
      <span class="text-gradient">{brandName}</span>
    </a>

    <nav class="hidden md:flex items-center gap-6">
      {navItems.map((item) => (
        <a
          href={item.href}
          class="text-sm font-medium text-muted-foreground transition-colors hover:text-foreground"
        >
          {item.label}
        </a>
      ))}
    </nav>

    <div class="flex items-center gap-4">
      <LanguageSwitcher currentLang={currentLang} />
      <a
        href={localizedHref('/pricing')}
        class="inline-flex items-center justify-center rounded-md bg-primary px-4 py-2 text-sm font-medium text-primary-foreground transition-colors hover:bg-primary/90"
      >
        {t.hero.getStarted}
      </a>
      
      <button
        id="mobile-menu-btn"
        class="md:hidden inline-flex items-center justify-center rounded-md p-2 text-muted-foreground hover:bg-accent hover:text-accent-foreground"
        aria-label="Toggle menu"
      >
        <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
        </svg>
      </button>
    </div>
  </div>

  <nav id="mobile-menu" class="hidden md:hidden border-t border-border bg-background">
    <div class="container mx-auto px-4 py-4 space-y-2">
      {navItems.map((item) => (
        <a
          href={item.href}
          class="block rounded-md px-3 py-2 text-base font-medium text-muted-foreground transition-colors hover:bg-accent hover:text-accent-foreground"
        >
          {item.label}
        </a>
      ))}
    </div>
  </nav>
</header>

<script>
  const menuBtn = document.getElementById('mobile-menu-btn');
  const mobileMenu = document.getElementById('mobile-menu');
  
  menuBtn?.addEventListener('click', () => {
    mobileMenu?.classList.toggle('hidden');
  });
</script>
